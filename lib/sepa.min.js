(function(t){var a="http://www.w3.org/2001/XMLSchema-instance";var s="urn:iso:std:iso:20022:tech:xsd:";var n="1.0";var e="UTF-8";var r="pain.008.001.02";var i=".";function o(t){i=t}var l=true;function d(t){l=!!t}var u={"pain.001.001.02":"pain.001.001.02","pain.001.003.02":"pain.001.003.02","pain.001.001.03":"CstmrCdtTrfInitn","pain.001.003.03":"CstmrCdtTrfInitn","pain.008.001.01":"pain.008.001.01","pain.008.003.01":"pain.008.003.01","pain.008.001.02":"CstmrDrctDbtInitn","pain.008.003.02":"CstmrDrctDbtInitn"};function c(t){var n=t.indexOf("pain.008")===0?1:0;return parseInt(t.substr(-2),10)+n}function h(t){this._painFormat=t||r;this._type=u[this._painFormat];this._paymentInfo=[];this._xmlVersion=n;this._xmlEncoding=e;this.grpHdr=new m(this._painFormat)}h.Types=u;h.prototype={_painFormat:null,grpHdr:null,_paymentInfo:[],_type:null,_xmlVersion:null,_xmlEncoding:null,addPaymentInfo:function(t){if(!(t instanceof p)){throw new Error("Given payment is not member of the PaymentInfo class")}if(t.id){t.id=this.grpHdr.id+i+t.id}else{t.id=this.grpHdr.id+i+this._paymentInfo.length}this._paymentInfo.push(t)},createPaymentInfo:function(){return new p(this._painFormat)},normalize:function(){var t=0;var n=0;for(var e=0,r=this._paymentInfo.length;e<r;++e){this._paymentInfo[e].normalize();t+=this._paymentInfo[e].controlSum;n+=this._paymentInfo[e].transactionCount}this.grpHdr.controlSum=t;this.grpHdr.transactionCount=n},toXML:function(){this.normalize();var t=s+this._painFormat;var n=O(t,"Document");n.xmlVersion=this._xmlVersion;n.xmlEncoding=this._xmlEncoding;var e=n.documentElement;e.setAttribute("xmlns:xsi",a);e.setAttribute("xsi:schemaLocation",s+this._painFormat+" "+this._painFormat+".xsd");var r=n.createElementNS(t,this._type);r.appendChild(this.grpHdr.toXML(n));for(var i=0,o=this._paymentInfo.length;i<o;++i){r.appendChild(this._paymentInfo[i].toXML(n))}n.documentElement.appendChild(r);return n},toString:function(){var t=this.toXML();var n='<?xml version="'+t.xmlVersion+'" encoding="'+t.xmlEncoding+'"?>';return n+L(t)}};function m(t){this._painFormat=t}m.prototype={_painFormat:null,id:"",created:"",transactionCount:0,initiatorName:"",controlSum:0,batchBooking:false,grouping:"MIXD",toXML:function(t){var n=M(t,true,true);var e=t.createElementNS(t.documentElement.namespaceURI,"GrpHdr");var r=c(this._painFormat);n(e,"MsgId",this.id);n(e,"CreDtTm",this.created.toISOString().substr(0,19));if(r===2){n(e,"BtchBookg",this.batchBooking.toString())}n(e,"NbOfTxs",this.transactionCount);n(e,"CtrlSum",this.controlSum.toFixed(2));if(r===2){n(e,"Grpg",this.grouping)}n(e,"InitgPty","Nm",this.initiatorName);return e},toString:function(){return L(this.toXML())}};var f={DirectDebit:"DD",Transfer:"TRF"};function p(t){this._painFormat=t;this.method=t.indexOf("pain.001")===0?f.Transfer:f.DirectDebit;this._payments=[]}p.PaymentInfoTypes=f;p.prototype={_painFormat:null,_payments:null,id:"",method:null,batchBooking:false,grouping:"MIXD",controlSum:0,localInstrumentation:"CORE",sequenceType:"FRST",collectionDate:null,requestedExecutionDate:null,creditorId:"",creditorName:"",creditorStreet:null,creditorCity:null,creditorCountry:null,creditorIBAN:"",creditorBIC:"",debtorId:"",debtorName:"",debtorStreet:null,debtorCity:null,debtorCountry:null,debtorIBAN:"",debtorBIC:"",instructionPriority:"NORM",get transactionCount(){return this._payments.length},normalize:function(){var t=0;for(var n=0,e=this._payments.length;n<e;++n){t+=this._payments[n].amount}this.controlSum=t},addTransaction:function(t){if(!(t instanceof y)){throw new Error("Given Transaction is not member of the SepaTransaction class")}if(t.id){t.id=this.id+i+t.id}else{t.id=this.id+i+this._payments.length}this._payments.push(t)},createTransaction:function(){return new y(this._painFormat)},validate:function(){var t=this.method===f.DirectDebit?"creditor":"debtor";B(this.localInstrumentation,["CORE","COR1","B2B"],"localInstrumentation");B(this.sequenceType,["FRST","RCUR","OOFF","FNAL"],"sequenceType");if(this.method===f.DirectDebit){T(this.collectionDate,"collectionDate")}else{T(this.requestedExecutionDate,"requestedExecutionDate")}E(this[t+"Id"],t+"Id");A(this[t+"Name"],null,70,t+"Name");A(this[t+"Street"],null,70,t+"Street");A(this[t+"City"],null,70,t+"City");A(this[t+"Country"],null,2,t+"Country");x(this[t+"IBAN"],t+"IBAN");A(this[t+"BIC"],[0,8,11],t+"BIC");var n=this[t+"BIC"].length===0||this[t+"BIC"].substr(4,2)===this[t+"IBAN"].substr(0,2);_(n,"country mismatch in BIC/IBAN");A(this._payments.length,1,null,"_payments")},toXML:function(t){if(l){this.validate()}var n=M(t,true,false);var e=M(t,true,true);var r=t.createElementNS(t.documentElement.namespaceURI,"PmtInf");e(r,"PmtInfId",this.id);e(r,"PmtMtd",this.method);if(c(this._painFormat)===3){e(r,"BtchBookg",this.batchBooking.toString());e(r,"NbOfTxs",this.transactionCount);e(r,"CtrlSum",this.controlSum.toFixed(2))}var i=n(r,"PmtTpInf");e(i,"SvcLvl","Cd","SEPA");if(this.method===f.DirectDebit){e(i,"LclInstrm","Cd",this.localInstrumentation);e(i,"SeqTp",this.sequenceType);e(r,"ReqdColltnDt",this.collectionDate.toISOString().substr(0,10))}else{e(r,"ReqdExctnDt",this.requestedExecutionDate.toISOString().substr(0,10))}var o=this.method===f.DirectDebit?"creditor":"debtor";var a=this.method===f.DirectDebit?"Cdtr":"Dbtr";var s=n(r,a);e(s,"Nm",this[o+"Name"]);if(this[o+"Street"]&&this[o+"City"]&&this[o+"Country"]){var d=n(s,"PstlAdr");e(d,"Ctry",this[o+"Country"]);e(d,"AdrLine",this[o+"Street"]);e(d,"AdrLine",this[o+"City"])}e(r,a+"Acct","Id","IBAN",this[o+"IBAN"]);if(this[o+"BIC"]){e(r,a+"Agt","FinInstnId","BIC",this[o+"BIC"])}else{e(r,a+"Agt","FinInstnId","Othr","Id","NOTPROVIDED")}e(r,"ChrgBr","SLEV");if(this.method===f.DirectDebit){var u=n(r,"CdtrSchmeId","Id","PrvtId","Othr");e(u,"Id",this.creditorId);e(u,"SchmeNm","Prtry","SEPA")}for(var h=0,m=this._payments.length;h<m;++h){r.appendChild(this._payments[h].toXML(t))}return r},toString:function(){return L(this.toXML())}};var I={DirectDebit:"DrctDbtTxInf",Transfer:"CdtTrfTxInf"};function y(t){this._painFormat=t;this._type=t.indexOf("pain.001")===0?I.Transfer:I.DirectDebit}y.TransactionTypes=I;y.prototype={_type:I.DirectDebit,id:"",end2endId:"",currency:"EUR",amount:0,purposeCode:null,mandateId:"",mandateSignatureDate:null,debtorName:"",debtorStreet:null,debtorCity:null,debtorCountry:null,debtorIBAN:"",debtorBIC:"",remittanceInfo:"",creditorName:"",creditorStreet:null,creditorCity:null,creditorCountry:null,creditorIBAN:"",creditorBIC:"",validate:function(){var t=this._type===I.Transfer?"creditor":"debtor";w(this.end2endId,"end2endId");N(this.amount,.01,999999999.99,"amount");_(this.amount==this.amount.toFixed(2),"amount has too many fractional digits");A(this.purposeCode,1,4,"purposeCode");F(this.mandateId,"mandateId");T(this.mandateSignatureDate,"mandateSignatureDate");A(this[t+"Name"],null,70,t+"Name");A(this[t+"Street"],null,70,t+"Street");A(this[t+"City"],null,70,t+"City");A(this[t+"Country"],null,2,t+"Country");x(this[t+"IBAN"],t+"IBAN");B(this[t+"BIC"].length,[0,8,11],t+"BIC");var n=this[t+"BIC"].length===0||this[t+"BIC"].substr(4,2)===this[t+"IBAN"].substr(0,2);_(n,"country mismatch in BIC/IBAN");A(this.remittanceInfo,null,140,"remittanceInfo")},toXML:function(t){if(l){this.validate()}var n=this._type===I.Transfer?"creditor":"debtor";var e=this._type===I.Transfer?"Cdtr":"Dbtr";var r=M(t,true,false);var i=M(t,false,true);var o=M(t,true,true);var a=t.createElementNS(t.documentElement.namespaceURI,this._type);var s=r(a,"PmtId");o(s,"InstrId",this.id);o(s,"EndToEndId",this.end2endId);if(this._type===I.DirectDebit){o(a,"InstdAmt",this.amount.toFixed(2)).setAttribute("Ccy",this.currency);var d=r(a,"DrctDbtTx","MndtRltdInf");o(d,"MndtId",this.mandateId);o(d,"DtOfSgntr",this.mandateSignatureDate.toISOString().substr(0,10));if(this.ammendment){o(d,"AmdmntInd","true");o(d,"AmdmnInfDtls",this.ammendment)}else{o(d,"AmdmntInd","false")}}else{o(a,"Amt","InstdAmt",this.amount.toFixed(2)).setAttribute("Ccy",this.currency)}if(this[n+"BIC"]){o(a,e+"Agt","FinInstnId","BIC",this[n+"BIC"])}else{o(a,e+"Agt","FinInstnId","Othr","Id","NOTPROVIDED")}var u=r(a,e);o(u,"Nm",this[n+"Name"]);if(this[n+"Street"]&&this[n+"City"]&&this[n+"Country"]){var h=r(u,"PstlAdr");o(h,"Ctry",this.debtorCountry);o(h,"AdrLine",this.debtorStreet);o(h,"AdrLine",this.debtorCity)}o(a,e+"Acct","Id","IBAN",this[n+"IBAN"]);o(a,"RmtInf","Ustrd",this.remittanceInfo);i(a,"Purp","Cd",this.purposeCode);return a}};function C(t){var n="";for(var e=0,r=t.length;e<r;++e){var i=t.charCodeAt(e);if(i>=65&&i<=90){n+=(i-55).toString()}else if(i>=97&&i<=122){n+=(i-87).toString()}else if(i>=48&&i<=57){n+=t[e]}}return n}function v(t){var n=0;for(var e=0,r=t.length;e<r;++e){n=(n*10+parseInt(t[e],10))%97}return n}function g(t){var n=t.substr(4)+t.substr(0,4);return v(C(n))===1}function b(t){var n=t.substr(4)+t.substr(0,2)+"00";var e=v(C(n));return t.substr(0,2)+("0"+(98-e)).substr(-2,2)+t.substr(4)}function D(t){var n=t.substr(7)+t.substr(0,4);return v(C(n))===1}function S(t){var n=t.substr(7)+t.substr(0,2)+"00";var e=v(C(n));return t.substr(0,2)+("0"+(98-e)).substr(-2,2)+t.substr(4)}function _(t,n){if(!t){throw new Error(n)}}function B(t,n,e){if(n.indexOf(t)<0){throw new Error(e+" must have any value of: "+n.join(" ")+"(found: "+t+")")}}function A(t,n,e,r){if(n!==null&&t&&t.length<n||e!==null&&t&&t.length>e){throw new Error(r+" has invalid string length, expected "+n+" < "+t+" < "+e)}}function N(t,n,e,r){if(t<n||t>e){throw new Error(r+" does not match range "+n+" < "+t+" < "+e)}}function x(t,n){if(!g(t)){throw new Error(n+' has invalid IBAN "'+t+'"')}}function E(t,n){if(!D(t)){throw new Error(n+' is invalid "'+t+'"')}}function T(t,n){if(!t||isNaN(t.getTime())){throw new Error(n+" has invalid date "+t)}}function w(t,n){if(t&&!t.match(/([A-Za-z0-9]|[+|?|/|\-|:|(|)|.|,|'| ]){1,35}/)){throw new Error(n+" doesn't match sepa id charset type 1 (found: "+'"'+t+'")')}}function F(t,n){if(t&&!t.match(/([A-Za-z0-9]|[+|?|/|\-|:|(|)|.|,|']){1,35}/)){throw new Error(n+" doesn't match sepa id charset type 2 (found: "+'"'+t+'")')}}function O(t,n){if(typeof document!=="undefined"&&typeof document.implementation!=="undefined"){return document.implementation.createDocument(t,n)}else{var e=require("@xmldom/xmldom").DOMImplementation;return(new e).createDocument(t,n)}}function L(t){var n;if(typeof window==="undefined"){var e=require("@xmldom/xmldom").XMLSerializer;n=new e}else{n=new window.XMLSerializer}return n.serializeToString(t)}function M(i,o,a){return function(){var t=arguments[0];var n=a&&arguments[arguments.length-1];var e=a?arguments.length-1:arguments.length;if(o||n||n===0){for(var r=1;r<e;++r){t=t.appendChild(i.createElementNS(i.documentElement.namespaceURI,arguments[r]))}if(a){t.textContent=n}return t}else{return null}}}t.Document=h;t.validateIBAN=g;t.checksumIBAN=b;t.validateCreditorID=D;t.checksumCreditorID=S;t.setIDSeparator=o;t.enableValidations=d})(typeof exports==="undefined"?this.SEPA={}:exports);
